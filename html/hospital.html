<!DOCTYPE html>
<html>
    <head>
        <title>MedZen</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/ionicons/css/ionicons.min.css" rel="stylesheet">
  <link href="../assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="../assets/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="../assets/vendor/venobox/venobox.css" rel="stylesheet">
        <style>
            #container-main{
                width: 1525px;
                height: auto;
            }
        
           
            body {
			  font-family: Arial, Helvetica, sans-serif;
			  background-color: white;
			}

			* {
			  box-sizing: border-box;
			}

			/* Add padding to containers */
			.container {
			  padding: 16px;
			  background-color: white;
			}

			/* Full-width input fields */
			input[type=text], input[type=password] {
			  width: 100%;
			  padding: 15px;
			  margin: 5px 0 22px 0;
			  display: inline-block;
			  border: none;
			  background: #f1f1f1;
			}

			input[type=text]:focus, input[type=password]:focus {
			  background-color: #ddd;
			  outline: none;
			}

			/* Overwrite default styles of hr */
			hr {
			  border: 1px solid #f1f1f1;
			  margin-bottom: 25px;
			}

			/* Set a style for the submit button */
			.registerbtn {
			  background-color: #4CAF50;
			  color: white;
			  padding: 16px 20px;
			  margin: 8px 0;
			  border: none;
			  cursor: pointer;
			  width: 100%;
			  opacity: 0.9;
			}

			.registerbtn:hover {
			  opacity: 1;
			}

			/* Add a blue text color to links */
			a {
			  color: dodgerblue;
			}

			/* Set a grey background color and center the text of the "sign in" section */
			.signin {
			  background-color: #f1f1f1;
			  text-align: center;
			}
						* {box-sizing: border-box;}

			body {
			  margin: 0;
			  font-family: Arial, Helvetica, sans-serif;
			}

			.topnav {
			  overflow: hidden;
			  background-color: #e9e9e9;
			}

			.topnav a {
			  float: left;
			  display: block;
			  color: black;
			  text-align: center;
			  padding: 14px 16px;
			  text-decoration: none;
			  font-size: 17px;
			}

			.topnav a:hover {
			  background-color: #ddd;
			  color: black;
			}

			.topnav a.active {
			  background-color: #2196F3;
			  color: white;
			}

			.topnav .login-container {
			  float: right;
			}

			.topnav input[type=text] {
			  padding: 6px;
			  margin-top: 8px;
			  font-size: 17px;
			  border: none;
			  width:120px;
			}

			.topnav .login-container button {
			  float: right;
			  padding: 6px 10px;
			  margin-top: 8px;
			  margin-right: 16px;
			  background-color: #555;
			  color: white;
			  font-size: 17px;
			  border: none;
			  cursor: pointer;
			}

			.topnav .login-container button:hover {
			  background-color: green;
			}

			@media screen and (max-width: 600px) {
			  .topnav .login-container {
				float: none;
			  }
			  .topnav a, .topnav input[type=text], .topnav .login-container button {
				float: none;
				display: block;
				text-align: left;
				width: 100%;
				margin: 0;
				padding: 14px;
			  }
			  .topnav input[type=text] {
				border: 1px solid #ccc;  
			  }
			}
            #display-from-blockchain{
                width:50%;
                height:auto;
                float: right;
            }
            #header1 {
		height: 100px;
		width: auto;
		background-color: #1DCCC4;
		font-size: 4em;
		text-align: center;
		color: white;
          font-family: sans-serif;
	  }
        </style>
    </head>
    <body>
        <header id="header1">MedZen</header>
        <div id="container-main">
            
        
        
        <form action="/action_page.php">
		  <div class="container">
			<h1>Register</h1>
			<p>Please fill in this form to create an account for your Hospital.</p>
			<hr>

			<label for="hosp_name"><b>Hospital name</b></label>
			<input type="text" placeholder="Enter Hospital name" name="hosp_name" id="hosp_name" required>

			<label for="location"><b>Hospital Location</b></label>
			<input type="text" placeholder="Location" name="location" id="hosp_loc" required>
			<button onclick="getLocation()">get location</button>
			  <br><br>
		  
			<label for="select_spl"><b>Hospital Specialization</b></label>
			<select id="specializations" name="select_spl">
			<option value="0">Multi Speciality</option>
			<option value="1">Eyes</option>
			<option value="2">Cancer</option>
			<option value="3">Cardio</option>
		  </select>
		<!-- <input type="text" placeholder="Select Specialization" name="spl" required> -->
		<br>
		<br>
		<!--<label for="psw"><b>Password</b></label>
		<input type="password" placeholder="password" name="password" id="password" required>-->    
		<hr>
		
    <p>By creating an account you agree to our <a href="#">Terms & Privacy</a>.</p>

    <button type="button" class="registerbtn" onclick="registerHosp()">Register</button>
    
      <!--Hospital Name:  <p id="disp_name">Amrita</p>
      <br>
      Hospital ID: <p id="disp_id">jvbdjfbvdkjbvdkjbvkjdfbvjdbvkjdfv</p>
      <br>
      
      Hospital Location: <p id="demo">Banjara hills</p>
      <br>
      
      Hospital Specialization: <p id="disp_spl">Multi Speciality</p>
      <br>
		  </div>
		  
		  <div class="container signin">
			<p>Already have an account? <a href="#">Sign in</a>.</p>
		  </div>-->
		</form>
        </div>
        
     <footer id="footer">
    <div class="container">
      <div class="row">
        <div class="col-lg-6 text-lg-left text-center">
          <div class="copyright">
            &copy; Copyright 2020 <strong>MedZen</strong>. All Rights Reserved
          </div>
          <div class="credits">
            
            Designed by <a href="#">Team MedZen</a>
          </div>
        </div>
        <div class="col-lg-6">
          <nav class="footer-links text-lg-right text-center pt-2 pt-lg-0">
            <a href="#intro" class="scrollto">Home</a>
            <a href="#about" class="scrollto">About</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Use</a>
          </nav>
        </div>
      </div>
    </div>
  </footer>

    <script src=" https://cdn.jsdelivr.net/npm/web3/dist/web3.js"></script>
    <script src="../js/abi.js"></script>
    <script>
		var account;
        window.addEventListener('load', async () => {
 	
		if (typeof window.ethereum !== 'undefined') { 
			console.log("MetaMask is installed!"); 
			}
			
		// Modern DApp browsers
		if (window.ethereum) {
			window.web3 = new Web3(ethereum);
			
			// To prevent the page reloading when the MetaMask network changes
			ethereum.autoRefreshOnNetworkChange = false;
			
			// To Capture the account details from MetaMask
			const accounts = await ethereum.enable();
			account = accounts[0];
				
			}
		// Legacy DApp browsers
		else if (window.web3) {
			//window.web3 = new Web3(web3.currentProvider);
			window.web3 = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/v3/cbd9dc11b30147e9a2cc974be655ef7c")); 
			}
		// Non-DApp browsers
		else {
			console.log('Non-Ethereum browser detected. Please install MetaMask');
			}

			});
    </script>
        
    <script>
		var x = document.getElementById("demo");

		function getLocation() {
		  if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(showPosition);
		  } else { 
			x.innerHTML = "Geolocation is not supported by this browser.";
		  }
		}

		function showPosition(position) {
		  x.innerHTML = "Latitude: " + position.coords.latitude + 
		  "<br>Longitude: " + position.coords.longitude;
		}
	</script>
        
    <script>
         
        
        //function to retrieve the last inserted value on the blockchain
        function registerHosp()
        {
            console.log("Registering Hospital...");

            try 
            {
               
                //instantiate and connect to contract address via Abi
                var myContract = new web3.eth.Contract(hospABI, hospSCAddr, {from: account, gasPrice: '5000000', gas: '300000'});
                
				
                var hosp_name = document.getElementById("hosp_name").value;
                var hosp_loc = document.getElementById("hosp_loc").value;
                var spl = document.getElementById("specializations").value;
                
				//call the get function of our SimpleStorage contract
                myContract.methods.registerHospital(hosp_name,hosp_loc, spl).send(function (err, result) 
                {
                    if (err) 
                    { 
                        console.log(err)
                    }
                    if (result) 
                    {
                        //display value on the webpage
                        console.log(result);
                    }
                });
            }
            catch (err) 
            {
                //document.getElementById("xbalance").innerHTML = err;
            }
        }
    </script> 
    </body>
</html>